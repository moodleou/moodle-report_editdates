define("report_editdates/datehelper",["exports","core/modal_factory","core/str"],(function(_exports,ModalFactory,_str){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,ModalFactory=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(ModalFactory);const farawayDate="December 31, 2099 23:59:59";let datetimeSelectors={},startDate={},endDate=new Date(farawayDate);_exports.init=()=>{datetimeSelectors=document.querySelectorAll("div[data-fieldtype='date_time_selector']");let courseStart=datetimeSelectors.item(0),courseEnd=datetimeSelectors.item(1);startDate=getDate(courseStart),courseEnd.querySelector("input[type='checkbox']").checked&&(endDate=getDate(courseEnd)),courseStart.addEventListener("change",startDateChanged),courseEnd.addEventListener("change",endDateChanged);for(const date of datetimeSelectors.entries())date[0]>1&&date[1].addEventListener("change",modDateChanged);M.form.dateselector.calendar.on("selectionChange",updateDates,!1)};const updateDates=()=>{let datepicker=M.form.dateselector.currentowner;null!==datepicker&&setTimeout((function(){let datetimeSelector=datepicker.calendarimage.getDOMNode().closest("div[data-fieldtype='date_time_selector']");datetimeSelector===datetimeSelectors.item(0)?startDateChanged():datetimeSelector===datetimeSelectors.item(1)?endDateChanged():checkDateRange(datetimeSelector)}),100)},startDateChanged=()=>{startDate=adjustDates(),checkAllDatesRange()},endDateChanged=()=>{let endDateSelector=datetimeSelectors.item(1),optional=endDateSelector.querySelector("input[type='checkbox']");endDate=optional.checked?getDate(endDateSelector):new Date(farawayDate),checkAllDatesRange()},modDateChanged=ev=>{let container=ev.target.closest("div[data-fieldtype='date_time_selector']");checkDateRange(container)},getDate=dateEl=>{let year=dateEl.querySelector(".fdate_time_selector > div:nth-child(3) select"),month=dateEl.querySelector(".fdate_time_selector > div:nth-child(2) select"),day=dateEl.querySelector(".fdate_time_selector > div:nth-child(1) select"),hour=dateEl.querySelector(".fdate_time_selector > div:nth-child(4) select"),minute=dateEl.querySelector(".fdate_time_selector > div:nth-child(5) select");return new Date(year.options[year.selectedIndex].value,month.options[month.selectedIndex].value-1,day.options[day.selectedIndex].value,hour.options[hour.selectedIndex].value,minute.options[minute.selectedIndex].value)},setDate=(dateEl,date)=>{let year=dateEl.querySelector(".fdate_time_selector > div:nth-child(3) select"),month=dateEl.querySelector(".fdate_time_selector > div:nth-child(2) select"),day=dateEl.querySelector(".fdate_time_selector > div:nth-child(1) select"),hour=dateEl.querySelector(".fdate_time_selector > div:nth-child(4) select"),minute=dateEl.querySelector(".fdate_time_selector > div:nth-child(5) select");year.querySelector("[value='"+date.getFullYear()+"']").selected="selected",month.querySelector("[value='"+(date.getMonth()+1)+"']").selected="selected",day.querySelector("[value='"+date.getDate()+"']").selected="selected",hour.querySelector("[value='"+date.getHours()+"']").selected="selected",minute.querySelector("[value='"+date.getMinutes()+"']").selected="selected"},checkAllDatesRange=()=>{let datesOutOfRange=0;for(const date of datetimeSelectors.entries())if(date[0]>1){let optional=date[1].querySelector("input[type='checkbox']");(null===optional||optional.checked)&&(datesOutOfRange+=checkDateRange(date[1]))}return datesOutOfRange>0&&ModalFactory.create({type:ModalFactory.types.DEFAULT,title:(0,_str.get_string)("datesoutofrange_title","report_editdates"),body:(0,_str.get_string)("datesoutofrange_body","report_editdates")}).then((modal=>(modal.show(),modal)))},checkDateRange=el=>{let outOfRange=!1,modDate=getDate(el);if(modDate>endDate||modDate<startDate){el.parentNode.classList.add("outofrange");for(const input of el.querySelectorAll(".form-group").values())input.classList.add("outofrange");outOfRange=!0}else{el.parentNode.classList.remove("outofrange");for(const input of el.querySelectorAll(".form-group").values())input.classList.remove("outofrange")}return outOfRange},adjustDates=()=>{if(!document.getElementById("id_movealldates").checked)return startDate;let newStart=getDate(datetimeSelectors.item(0)),dst1=startDate.getTimezoneOffset()-newStart.getTimezoneOffset(),change=newStart-startDate+6e4*dst1;for(const date of datetimeSelectors.entries())if(date[0]>0){let optional=date[1].querySelector("input[type='checkbox']");if(null===optional||optional.checked){let currDate=getDate(date[1]),newDate=new Date(currDate.getTime()+change),dst2=newDate.getTimezoneOffset()-currDate.getTimezoneOffset();newDate=new Date(newDate.getTime()+6e4*dst2),setDate(date[1],newDate)}}let endDateSelector=datetimeSelectors.item(1),optional=endDateSelector.querySelector("input[type='checkbox']");return endDate=optional.checked?getDate(endDateSelector):new Date(farawayDate),newStart}}));

//# sourceMappingURL=datehelper.min.js.map