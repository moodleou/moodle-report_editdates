define("report_editdates/datehelper",["exports","core/modal_factory","core/str"],(function(_exports,ModalFactory,_str){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,ModalFactory=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(ModalFactory);let datetimeSelectors={},startDate={},endDate=new Date("December 31, 2099 23:59:59");_exports.init=()=>{datetimeSelectors=document.querySelectorAll("div[data-fieldtype='date_time_selector']");let courseStart=datetimeSelectors.item(0),courseEnd=datetimeSelectors.item(1);startDate=getDate(courseStart),courseEnd.querySelector("input[type='checkbox']").checked&&(endDate=getDate(courseEnd)),courseStart.addEventListener("change",startDateChanged),courseEnd.addEventListener("change",endDateChanged);for(const date of datetimeSelectors.entries())date[0]>1&&date[1].addEventListener("change",modDateChanged);M.form.dateselector.calendar.on("selectionChange",updateDates,!1)};const updateDates=()=>{let datepicker=M.form.dateselector.currentowner;null!==datepicker&&setTimeout((function(){let datetimeSelector=datepicker.calendarimage.getDOMNode().closest("div[data-fieldtype='date_time_selector']");datetimeSelector===datetimeSelectors.item(0)?startDateChanged():datetimeSelector===datetimeSelectors.item(1)?endDateChanged():checkDateRange(datetimeSelector)}),100)},startDateChanged=()=>{let datesOutOfRange=0;startDate=getDate(datetimeSelectors.item(0));for(const date of datetimeSelectors.entries())if(date[0]>1){let optional=date[1].querySelector("input[type='checkbox']");(null===optional||optional.checked)&&(datesOutOfRange+=checkDateRange(date[1]))}return datesOutOfRange>0&&ModalFactory.create({type:ModalFactory.types.DEFAULT,title:(0,_str.get_string)("datesoutofrange_title","report_editdates"),body:(0,_str.get_string)("datesoutofrange_body","report_editdates")}).then((modal=>(modal.show(),modal)))},endDateChanged=()=>{let datesOutOfRange=0;endDate=getDate(datetimeSelectors.item(1));for(const date of datetimeSelectors.entries())if(date[0]>1){let optional=date[1].querySelector("input[type='checkbox']");(null===optional||optional.checked)&&(datesOutOfRange+=checkDateRange(date[1]))}if(datesOutOfRange>0)return ModalFactory.create({type:ModalFactory.types.DEFAULT,title:(0,_str.get_string)("datesoutofrange_title","report_editdates"),body:(0,_str.get_string)("datesoutofrange_body","report_editdates")}).then((modal=>(modal.show(),modal)))},modDateChanged=ev=>{let container=ev.target.closest("div[data-fieldtype='date_time_selector']");checkDateRange(container)},getDate=dateEl=>{let year=dateEl.querySelector(".fdate_time_selector > div:nth-child(3) select"),month=dateEl.querySelector(".fdate_time_selector > div:nth-child(2) select"),day=dateEl.querySelector(".fdate_time_selector > div:nth-child(1) select"),hour=dateEl.querySelector(".fdate_time_selector > div:nth-child(4) select"),minute=dateEl.querySelector(".fdate_time_selector > div:nth-child(5) select");return new Date(year.options[year.selectedIndex].value,month.options[month.selectedIndex].value-1,day.options[day.selectedIndex].value,hour.options[hour.selectedIndex].value,minute.options[minute.selectedIndex].value)},checkDateRange=el=>{let outOfRange=!1,modDate=getDate(el);if(modDate>endDate||modDate<startDate){el.parentNode.classList.add("outofrange");for(const input of el.querySelectorAll(".form-group").values())input.classList.add("outofrange");outOfRange=!0}else{el.parentNode.classList.remove("outofrange");for(const input of el.querySelectorAll(".form-group").values())input.classList.remove("outofrange")}return outOfRange}}));

//# sourceMappingURL=datehelper.min.js.map